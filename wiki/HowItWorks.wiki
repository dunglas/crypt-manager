#summary Detailed crypt manager process and files
#labels Phase-Implementation
= Introduction =

_Crypt Manager_ maintain a list of encrypted folders, and stock encrypted images on a specific format.


= Details =

==Process==

===Folder encryption===

   * Creation of the image in ~/.config/crypmanager/img/
   * Allocation of a loopback device (using the sha256 hash of the path name to have a unique ID)
   * Move of existing data in a temporary directory
   * Encryption with cryptsetup/LUKS
   * Mapping of the encrypted folder
   * Format using ext3 FS
   * Mounting
   * Copy of files in the temporary dir
   * Unmount
   * Add the folder to the list (object Folders)

===Open an encrypted folder===

  * Allocation of the loopback device
  * Opening of the disk image
  * Mount

===Close an encrypted folder===
  * Unmount
  * Close the disk image
  * Delete the loopback device

===Uncrypt a folder===

  * Open the folder
  * Copy data in a temporary directory
  * Close the folder
  * Delete the encrypted disk image
  * Remove the folder from the list (object Folders)
  

==Files==
===~/.config/crypmanager/img/===

_~/.config/crypmanager/img/_ contain all encrypted disk images of folders. The name of the image is the sha256 hash of the folder full path name. It allow to test if a folder is encrypted because a sha256 hash is unique (low collision risk).

===~/.config/crypmanager/cache/folders===

_~/.config/crypmanager/cache/_ contain a file called _folders_ which is a binary serialization of the object "Folders" (the list of encrypted folders) of the cryptmanager.py module.

===/tmp/cryptmanager===
_/tmp/crypmanager/_ is a temporary space for copy/paste/move operations during the encryption and unencryption process.
It also use the sha256 hash of the path to unique the temporary path and it is cleaned at the end of each process.